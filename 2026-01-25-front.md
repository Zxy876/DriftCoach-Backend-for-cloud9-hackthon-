DriftCoach Frontend — Engineering Goal（v0.2，可落地版）

本文件是前端阶段的工程落地宪法，约束范围、交付物、验收标准与执行顺序，直接可转为 backlog 与 PR 检查单。

⸻

0. 定位（冻结，不得修改）
- 前端是 DriftCoach Backend 分析结果的「决策复盘界面」，不是聊天、不是战术推荐、不是即时指挥。
- 唯一职责：将后端已产出的结构化结果（Insight / ReviewAgendaItem / WhatIfOutcome），以可理解、可质疑的形式呈现。
- 不产出新结论，不改写数值，不给动作建议。

⸻

1. 交付目标（Goal）
- 在不接入真实 GRID API、不扩展后端分析逻辑的前提下，完成一个可演示的单页界面，满足：
  - 同屏（或单页）展示三类结果：Player/Team Insight、Post-match Review Agenda、What-if Outcome Comparison。
  - 显式暴露不确定性：baseline、sample size、confidence/信号强度。
  - LLM 仅做解释层，可开关，失败有模板回退。
  - 评委/教练 30 秒内能理解系统作用、边界与可信度。

⸻

2. 范围约束（Scope & Non-goals）
- 必做：消费后端 JSON（Insight / ReviewAgendaItem / WhatIfOutcome）并渲染；展示 confidence、样本量；展示 Assumptions & Limits；LLM 文本解释可开关。
- 禁止（写入 README 与代码注释）：
  - 聊天式 UI / Copilot / 自由提问。
  - “你应该怎么打”类推荐、即时指挥。
  - 隐藏或弱化 confidence / sample size。
  - LLM 改写、增强或推导新结论；改写数值。
  - 直接展示原始 GRID 数据或 State/Transition 等中间态。

⸻

3. 输入契约（Input Contract）
- 仅接受：`Insight`、`ReviewAgendaItem`、`WhatIfOutcome`（对应后端输出）。
- 前端不得访问：`State`、`Transition`、`DerivedFact` 之外的中间计算，亦不得直接触达原始 GRID 数据。
- 需提供 mock JSON，字段对齐后端 demo 输出（含 baseline、support/sample、confidence）。

⸻

4. 体系结构与页面骨架
- 单页应用（SPA），初期用静态 mock JSON 驱动，预留 FastAPI proxy 接入点。
- 页面区域（冻结）：
  1) Context Header：显示 Player/Team、Match/Map/Timestamp、数据来源（Mock/GRID）、分析时间窗。
  2) Panel A — Player Insight：Claim、指标值、baseline、sample size、Confidence（数值或等级）、Explanation（LLM 或模板）。
  3) Panel B — Post-match Review：Agenda Topic、Why this matters、Evidence States（可展开）。
  4) Panel C — What-if Analysis：State 标识、Action 对比表/图；每个 action 的 win probability、support/sample、overall confidence；风险/稳定性解释（LLM 或模板）。
  5) Assumptions & Limits：固定展示 “Based on similar historical states / Signal strength: weak|moderate|strong / This is not a recommendation”。

⸻

5. LLM 使用原则（冻结）
- 仅用于解释层：输入结构化结果 → 输出解释文本。
- 禁止修改数值、生成新结论、给出行动推荐。
- 必须有：LLM 开关、失败回退模板（纯文本）、显式标注使用/未使用 LLM。

⸻

6. 工程与实现约束
- 技术栈建议：SPA（React/Vue 任一），TypeScript；样式可用简单组件库或自定。
- 数据层：先用本地 mock JSON；接口层预留 `GET /api/demo`（或文件加载）入口，未来可换 FastAPI。
- 刷新模式：pull/refresh 即可，不要求实时推送。

⸻

7. Definition of Done（前端阶段）
- 三类分析结果可完整展示，字段与后端输出一一对应。
- 所有数值来源可追溯（mock 文件或 API 响应），界面可见 sample/confidence。
- LLM 解释可开关，失败有模板回退；无聊天入口、无 agent 语义。
- 页面 30 秒内可讲清系统作用/边界；Assumptions & Limits 区默认展开或可见。

⸻

8. 执行清单（Epic / Issue，可直接转 backlog）

Epic F0：工程约束与冻结
- Issue F0.1 工程约束声明：在 README 增加 “Out of Scope (Frontend)” 列表；代码注释标明 LLM 仅解释、不改数值。

Epic F1：输入契约与数据模型
- Issue F1.1 定义前端 Input Types：`types/insight.ts`、`types/review.ts`、`types/whatif.ts`；UI 组件仅接受这些类型；附 mock JSON 示例。

Epic F2：页面骨架与布局
- Issue F2.1 Context Header 组件：展示 player/match/source/window。
- Issue F2.2 Analysis Panels 容器：Tabs/Cards 布局，接占位 mock 数据。

Epic F3：三类分析面板
- Issue F3.1 Player Insight Panel：Claim、Data(value/baseline/sample)、Confidence 可视化、Explanation 文本。
- Issue F3.2 Post-match Review Panel：Agenda 列表 + Evidence states 展开。
- Issue F3.3 What-if Analysis Panel：Action 对比表，win probability + sample + confidence，风险解释区。

Epic F4：LLM 解释层（前端）
- Issue F4.1 LLM Wrapper：`llm/render.ts`，输入 JSON → 文本；失败回退模板；不新增数值或建议。

Epic F5：演示流与收尾
- Issue F5.1 Demo Flow 固定化：固定 mock JSON、固定展示顺序（1 Insight → 2 Review → 3 What-if）。
- Issue F5.2 Assumptions & Limits 区块：固定免责声明区，默认可见。

Epic F6：Definition of Done 验证
- Issue F6.1 DoD 自检：无聊天入口；数值可追溯；confidence 明确；LLM 可关闭；30 秒可讲清系统作用。

⸻

9. 落地检查清单（PR 级）
- README：包含前端 Out of Scope，声明 LLM 仅解释；无聊天/推荐/指挥声明。
- types：存在并被组件引用；mock JSON 字段与后端 demo 对齐（含 baseline/support/confidence）。
- UI：ContextHeader、三面板、Assumptions 区块均可见；Confidence/样本量显式展示。
- LLM：有开关、有失败回退；文案不生成新数值或建议。
- 演示：一键加载 mock 数据即可完成全链路展示，无需真实 GRID。

 